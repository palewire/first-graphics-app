
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>8. Charts &#8212; First Visual Story  documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css" />
    <link rel="stylesheet" type="text/css" href="_static/css/custom.css" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="9. Map" href="map.html" />
    <link rel="prev" title="7. Cards" href="cards.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
    <link rel="canonical" href="https://palewi.re/docs/First Visual Story/charts.html"/>
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <nav>
    <div class="row">
        <div class="sevencol">
            <div class="shingle">
                <a href="https://palewi.re/">
                    <div rel="rnews:copyrightedBy rnews:hasSource rnews:providedBy">
                        <div about="http://palewi.re/" typeof="rnews:Organization">
                            <div property="rnews:name">palewire</div>
                        </div>
                    </div>
                </a>
            </div>
        </div>
        <div class="fivecol last links">
            <ul>
                <li>
                    <a href="http://palewi.re/posts/" title="Posts">
                        Posts
                    </a>
                </li>
                <li>
                    <a href="http://palewi.re/work/" title="Work">
                        Work
                    </a>
                </li>
                <li>
                    <a href="http://palewi.re/talks/" title="Talks">
                        Talks
                    </a>
                </li>
                <li>
                    <a href="http://palewi.re/who-is-ben-welsh/" title="Who is Ben Welsh?">
                        About
                    </a>
                </li>
            </ul>
        </div>
    </div>
</nav>
<div class="row topbar">
    <div class="twelvecol last"></div>
</div>
<section id="charts">
<h1><span class="section-number">8. </span>Charts<a class="headerlink" href="#charts" title="Permalink to this headline">¶</a></h1>
<p>To visualize our data, we’re going to use the <a class="reference external" href="https://d3js.org/">D3.js</a> library, which has become the industry standard for creating custom data visualizations. Because it is so flexible and allows for so many different data-driven expressions, D3 powers many of the news graphics made with JavaScript you see online.</p>
<p>:::{note}
We’re going to dive straight into the deep end by creating a D3 chart from scratch. It involves a lot of code and will probably seem like overkill.</p>
<p>In fact, it is. D3 gives you a very high level of control over your graphics. It takes a long period of study to master. No one can do in a day.</p>
<p>Our goal in this class is to instead quickly introduce you to D3’s basic outlines so you can see how it is being used in the field.
:::</p>
<p>First, return to your terminal and use npm to install D3.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ npm install d3@5
</pre></div>
</div>
<p>From here, we’ll be working in our <code class="docutils literal notranslate"><span class="pre">_scripts</span></code> folder, where our framework expects us to write JavaScript.</p>
<p>It includes a file called <code class="docutils literal notranslate"><span class="pre">main.js</span></code> which is run every time the page loads. Our framework starts us out with some boilerplate there.</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="c1">// Main javascript entry point</span>
<span class="c1">// Should handle bootstrapping/starting application</span>

<span class="s1">&#39;use strict&#39;</span><span class="p">;</span>

<span class="k">import</span> <span class="s1">&#39;core-js&#39;</span><span class="p">;</span>
<span class="k">import</span> <span class="s1">&#39;regenerator-runtime/runtime&#39;</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">$</span> <span class="kr">from</span> <span class="s1">&#39;jquery&#39;</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">Link</span> <span class="p">}</span> <span class="kr">from</span> <span class="s1">&#39;../_modules/link/link&#39;</span><span class="p">;</span>

<span class="nx">$</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="ow">new</span> <span class="nx">Link</span><span class="p">();</span> <span class="c1">// Activate Link modules logic</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Welcome to Yeogurt!&#39;</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>
</div>
<p>Rather than write our code directly in there, we are going to create a separate file for our charts. We will call it <code class="docutils literal notranslate"><span class="pre">_charts.js</span></code> and save it inside of <code class="docutils literal notranslate"><span class="pre">_scripts/</span></code>.</p>
<p>:::{note}
Remember the underscore coding convention we talked about befre? Here it is again. We named our new file <code class="docutils literal notranslate"><span class="pre">_charts.js</span></code> with an underscore (<code class="docutils literal notranslate"><span class="pre">_</span></code>) in front because its code will be compiled into <code class="docutils literal notranslate"><span class="pre">main.js</span></code> when the site is baked. Unlike <code class="docutils literal notranslate"><span class="pre">_charts.js</span></code>, <code class="docutils literal notranslate"><span class="pre">main.js</span></code> doesn’t have an underscore, because it is the master file that pulls in all the other scripts.</p>
<p>Structuring our code this way helps keep things organized, as each file controls one specific part of the page. Need to make an adjustment to your chart? Go to <code class="docutils literal notranslate"><span class="pre">_charts.js</span></code>.
:::</p>
<p>You can include the libraries we installed (or any JavaScript file!) by using <code class="docutils literal notranslate"><span class="pre">import</span></code>. While with modern versions of D3 you can import only the specific parts of the library needed by your app, we’re just going to import the whole library for simplicity.</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="k">import</span> <span class="o">*</span> <span class="kr">as</span> <span class="nx">d3</span> <span class="kr">from</span> <span class="s2">&quot;d3&quot;</span><span class="p">;</span>

<span class="c1">// At the end of the _charts.js file</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;hello, this is my charts file!&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p>Now we can use the same <code class="docutils literal notranslate"><span class="pre">import</span></code> method to pull our charts code into <code class="docutils literal notranslate"><span class="pre">main.js</span></code>.</p>
<p>You don’t have to use this convention, but it’s handy as a visual marker of what files are dependent on others.</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="c1">// Main javascript entry point</span>
<span class="c1">// Should handle bootstrapping/starting application</span>

<span class="s1">&#39;use strict&#39;</span><span class="p">;</span>

<span class="k">import</span> <span class="s1">&#39;core-js&#39;</span><span class="p">;</span>
<span class="k">import</span> <span class="s1">&#39;regenerator-runtime/runtime&#39;</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">$</span> <span class="kr">from</span> <span class="s1">&#39;jquery&#39;</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">Link</span> <span class="p">}</span> <span class="kr">from</span> <span class="s1">&#39;../_modules/link/link&#39;</span><span class="p">;</span>
<span class="hll"><span class="k">import</span> <span class="s1">&#39;./_charts.js&#39;</span><span class="p">;</span>
</span>
<span class="nx">$</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="ow">new</span> <span class="nx">Link</span><span class="p">();</span> <span class="c1">// Activate Link modules logic</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Welcome to Yeogurt!&#39;</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>
</div>
<p>Now if you reload your page and go to your inspector by right clicking on the page and selecting “inspect”, you should see <code class="docutils literal notranslate"><span class="pre">hello,</span> <span class="pre">this</span> <span class="pre">is</span> <span class="pre">my</span> <span class="pre">charts</span> <span class="pre">file!</span></code> in the console.</p>
<a class="reference internal image-reference" href="_images/hello-charts.png"><img alt="_images/hello-charts.png" src="_images/hello-charts.png" style="width: 100%;" /></a>
<p>Now that we have our tools, it’s time for the real work. What chart should we make? The story points out that Harvard Park experienced an increase in homicides at the same time there was a decrease across the rest of the county. Let’s try to visualize that.</p>
<p>First, we need somewhere for our charts to live on the page. In our <code class="docutils literal notranslate"><span class="pre">index.nunjucks</span></code> file, inside of <code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">block</span> <span class="pre">content</span> <span class="pre">%}</span></code> where you want the chart to appear, create a <code class="docutils literal notranslate"><span class="pre">div</span></code> element with an id of <code class="docutils literal notranslate"><span class="pre">county-homicides</span></code>, and another with an id of <code class="docutils literal notranslate"><span class="pre">harvard-park-homicides</span></code>.</p>
<div class="highlight-jinja notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">extends</span> <span class="s1">&#39;_layouts/base.nunjucks&#39;</span> <span class="cp">%}</span><span class="x"></span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">headline</span> <span class="cp">%}</span><span class="x">My headline will go here</span><span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span><span class="x"></span>
<span class="cp">{%</span> <span class="k">block</span> <span class="nv">byline</span> <span class="cp">%}</span><span class="x">By me</span><span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span><span class="x"></span>
<span class="cp">{%</span> <span class="k">block</span> <span class="nv">pubdate</span> <span class="cp">%}</span><span class="x"></span>
<span class="x">    &lt;time datetime=&quot;2018-03-10&quot; pubdate&gt;Mar. 10, 2018&lt;/time&gt;</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span><span class="x"></span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">content</span> <span class="cp">%}</span><span class="x"></span>

<span class="hll"><span class="x">&lt;div class=&quot;charts&quot;&gt;</span>
</span><span class="hll"><span class="x">  &lt;div class=&quot;inline-chart&quot; id=&quot;county-homicides&quot;&gt;&lt;/div&gt;</span>
</span><span class="hll"><span class="x">  &lt;div class=&quot;inline-chart&quot; id=&quot;harvard-park-homicides&quot;&gt;&lt;/div&gt;</span>
</span><span class="hll"><span class="x">&lt;/div&gt;</span>
</span>
<span class="x">&lt;section&gt;</span>
<span class="x">    &lt;h3&gt;Lives lost&lt;/h3&gt;</span>
<span class="x">    &lt;p&gt;The </span><span class="cp">{{</span> <span class="nv">site.data.harvard_park_homicides</span><span class="o">|</span><span class="nf">length</span> <span class="cp">}}</span><span class="x"> homicides in Harvard Park since 2000 were primarily black and Latino males, but the list includes husbands, wives, fathers, mothers of all ages, and even some small children.&lt;/p&gt;</span>
<span class="x">    &lt;div class=&quot;card-columns&quot;&gt;</span>
<span class="x">    </span><span class="cp">{%</span> <span class="k">for</span> <span class="nv">obj</span> <span class="k">in</span> <span class="nv">site.data.harvard_park_homicides</span> <span class="cp">%}</span><span class="x"></span>
<span class="x">        &lt;div class=&quot;card&quot;&gt;</span>
<span class="x">        </span><span class="cp">{%</span> <span class="k">if</span> <span class="nv">obj.image</span> <span class="cp">%}</span><span class="x">&lt;img class=&quot;card-img-top&quot; src=&quot;</span><span class="cp">{{</span> <span class="nv">obj.image</span> <span class="cp">}}</span><span class="x">&quot; alt=&quot;</span><span class="cp">{{</span> <span class="nv">obj.first_name</span> <span class="cp">}}</span><span class="x"> </span><span class="cp">{{</span> <span class="nv">obj.last_name</span> <span class="cp">}}</span><span class="x">&quot;&gt;</span><span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span><span class="x"></span>
<span class="x">        &lt;div class=&quot;card-body&quot;&gt;</span>
<span class="x">            &lt;a href=&quot;http://homicide.latimes.com/post/</span><span class="cp">{{</span> <span class="nv">obj.slug</span> <span class="cp">}}</span><span class="x">&quot; target=&quot;_blank&quot;&gt;</span>
<span class="x">                    &lt;strong&gt;</span>
<span class="x">                        &lt;h5 class=&quot;card-title&quot;&gt;</span><span class="cp">{{</span> <span class="nv">obj.first_name</span> <span class="cp">}}</span><span class="x"> </span><span class="cp">{{</span> <span class="nv">obj.last_name</span> <span class="cp">}}</span><span class="x">&lt;/h5&gt;</span>
<span class="x">                    &lt;/strong&gt;</span>
<span class="x">                &lt;/a&gt;</span>
<span class="x">            &lt;p class=&quot;card-text&quot;&gt;</span><span class="cp">{{</span> <span class="nv">obj.last_name</span> <span class="cp">}}</span><span class="x">, a </span><span class="cp">{{</span> <span class="nv">obj.age</span><span class="cp">}}</span><span class="x">-year-old </span><span class="cp">{{</span> <span class="nv">obj.race</span> <span class="cp">}}</span><span class="x"> </span><span class="cp">{{</span> <span class="nv">obj.gender</span> <span class="cp">}}</span><span class="x">, died in </span><span class="cp">{{</span> <span class="nv">obj.death_year</span> <span class="cp">}}</span><span class="x">.&lt;/p&gt;</span>
<span class="x">        &lt;/div&gt;</span>
<span class="x">        &lt;/div&gt;</span>
<span class="x">    </span><span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span><span class="x"></span>
<span class="x">    &lt;/div&gt;</span>
<span class="x">&lt;/section&gt;</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span><span class="x"></span>
</pre></div>
</div>
<p>That’s nice, but we can’t make a chart without data. Copy the <a class="reference external" href="https://raw.githubusercontent.com/ireapps/first-graphics-app/master/data/annual_totals.json">annual totals data</a> on GitHub to a new file at <code class="docutils literal notranslate"><span class="pre">_data/annual_totals.json</span></code>. This file contains annual homicide counts for Harvard Park and all of Los Angeles County.</p>
<p>That’s nice, but we can’t make a chart without data. Copy the <a class="reference external" href="https://raw.githubusercontent.com/ireapps/first-graphics-app/master/data/annual_totals.json">annual totals data</a> on GitHub to a new file at <code class="docutils literal notranslate"><span class="pre">_data/annual_totals.json</span></code>. This file contains annual homicide counts for Harvard Park and all of Los Angeles County.</p>
<p>We can use the same import syntax to include the data in our <code class="docutils literal notranslate"><span class="pre">_charts.js</span></code> file. Since it’s a JSON file it will work right away.</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="k">import</span> <span class="o">*</span> <span class="kr">as</span> <span class="nx">d3</span> <span class="kr">from</span> <span class="s2">&quot;d3&quot;</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">annualTotals</span> <span class="kr">from</span> <span class="s2">&quot;../_data/annual_totals&quot;</span><span class="p">;</span>
</pre></div>
</div>
<p>We want to make two charts - one of county homicides and one of killings in Harvard Park. Let’s start with county homicides. D3 requires us to do a bit of house work before we get started. The first thing we need is a container for our chart to go in. We’ll be making these charts in an <code class="docutils literal notranslate"><span class="pre">&lt;svg&gt;</span></code> element, which stands for Scalable Vector Graphic.</p>
<p>The first thing we’ll want to do is select the HTML container of the chart with D3, and “append” an <code class="docutils literal notranslate"><span class="pre">svg</span></code> element to it. So, back in <code class="docutils literal notranslate"><span class="pre">_charts.js</span></code>, lets add the following:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="k">import</span> <span class="o">*</span> <span class="kr">as</span> <span class="nx">d3</span> <span class="kr">from</span> <span class="s2">&quot;d3&quot;</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">annualTotals</span> <span class="kr">from</span> <span class="s2">&quot;../_data/annual_totals&quot;</span><span class="p">;</span>

<span class="hll"><span class="c1">// Make sure you use the # here!</span>
</span><span class="hll"><span class="kd">var</span> <span class="nx">container</span> <span class="o">=</span> <span class="nx">d3</span><span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="s1">&#39;#county-homicides&#39;</span><span class="p">);</span>
</span><span class="hll"><span class="kd">var</span> <span class="nx">svg</span> <span class="o">=</span> <span class="nx">container</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s1">&#39;svg&#39;</span><span class="p">)</span>
</span></pre></div>
</div>
<p>Now if you look in your inspector, you’ll see that we’ve appended an <code class="docutils literal notranslate"><span class="pre">&lt;svg&gt;</span></code> to the element with an ID of <code class="docutils literal notranslate"><span class="pre">county-homicides</span></code>. However, we also need to specify a height and width for the SVG, otherwise it will always just have default dimensions of 300x150, no matter how large our screen or device is.</p>
<a class="reference internal image-reference" href="_images/chart-empty-svg.png"><img alt="_images/chart-empty-svg.png" src="_images/chart-empty-svg.png" style="width: 100%;" /></a>
<p>Let’s use <code class="docutils literal notranslate"><span class="pre">.node()</span></code> to access the HTML element and save the width and height of the container to variables. I like to specify the height as a percentage of the width, to get an aspect ratio.</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="k">import</span> <span class="o">*</span> <span class="kr">as</span> <span class="nx">d3</span> <span class="kr">from</span> <span class="s2">&quot;d3&quot;</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">annualTotals</span> <span class="kr">from</span> <span class="s2">&quot;../_data/annual_totals&quot;</span><span class="p">;</span>

<span class="c1">// Make sure you use the # here!</span>
<span class="kd">var</span> <span class="nx">container</span> <span class="o">=</span> <span class="nx">d3</span><span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="s1">&#39;#county-homicides&#39;</span><span class="p">);</span>
<span class="hll"><span class="kd">var</span> <span class="nx">containerWidth</span> <span class="o">=</span> <span class="nx">container</span><span class="p">.</span><span class="nx">node</span><span class="p">().</span><span class="nx">offsetWidth</span><span class="p">;</span>
</span><span class="hll"><span class="kd">var</span> <span class="nx">containerHeight</span> <span class="o">=</span> <span class="nx">containerWidth</span> <span class="o">*</span> <span class="mf">0.66</span><span class="p">;</span>
</span>
<span class="kd">var</span> <span class="nx">svg</span> <span class="o">=</span> <span class="nx">container</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s1">&#39;svg&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Now we can use them to set the properties, or “attributes” of the SVG using D3’s <code class="docutils literal notranslate"><span class="pre">.attr()</span></code> method. Notice that we can “chain” methods on a selection in D3, which allows our code to be a little more concise.</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="k">import</span> <span class="o">*</span> <span class="kr">as</span> <span class="nx">d3</span> <span class="kr">from</span> <span class="s2">&quot;d3&quot;</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">annualTotals</span> <span class="kr">from</span> <span class="s2">&quot;../_data/annual_totals&quot;</span><span class="p">;</span>

<span class="c1">// Make sure you use the # here!</span>
<span class="kd">var</span> <span class="nx">container</span> <span class="o">=</span> <span class="nx">d3</span><span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="s1">&#39;#county-homicides&#39;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">containerWidth</span> <span class="o">=</span> <span class="nx">container</span><span class="p">.</span><span class="nx">node</span><span class="p">().</span><span class="nx">offsetWidth</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">containerHeight</span> <span class="o">=</span> <span class="nx">containerWidth</span> <span class="o">*</span> <span class="mf">0.66</span><span class="p">;</span>

<span class="kd">var</span> <span class="nx">svg</span> <span class="o">=</span> <span class="nx">container</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s1">&#39;svg&#39;</span><span class="p">)</span>
<span class="hll">            <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;width&#39;</span><span class="p">,</span> <span class="nx">containerWidth</span><span class="p">)</span>
</span><span class="hll">            <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;height&#39;</span><span class="p">,</span> <span class="nx">containerHeight</span><span class="p">)</span>
</span></pre></div>
</div>
<p>Now if you look, your SVG should be rendered at the appropriate height and width, filling the available space.</p>
<a class="reference internal image-reference" href="_images/chart-empty-svg-2.png"><img alt="_images/chart-empty-svg-2.png" src="_images/chart-empty-svg-2.png" style="width: 100%;" /></a>
<p>Two more setup steps before we actually start making our charts. First, if we simply start drawing data onto the SVG, we’ll likely see areas where the data clips off the chart. We can avoid this by defining a pre-set margin we’ll use throughout the process.</p>
<p>We also create two variables, <code class="docutils literal notranslate"><span class="pre">chartWidth</span></code> and <code class="docutils literal notranslate"><span class="pre">chartHeight</span></code> that refer to the dimensions of the chart with the margins included.</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="k">import</span> <span class="o">*</span> <span class="kr">as</span> <span class="nx">d3</span> <span class="kr">from</span> <span class="s2">&quot;d3&quot;</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">annualTotals</span> <span class="kr">from</span> <span class="s2">&quot;../_data/annual_totals&quot;</span><span class="p">;</span>

<span class="hll"><span class="kd">var</span> <span class="nx">margin</span> <span class="o">=</span> <span class="p">{</span><span class="nx">top</span><span class="o">:</span> <span class="mf">20</span><span class="p">,</span> <span class="nx">right</span><span class="o">:</span><span class="mf">20</span><span class="p">,</span> <span class="nx">bottom</span><span class="o">:</span><span class="mf">20</span><span class="p">,</span> <span class="nx">left</span><span class="o">:</span><span class="mf">40</span><span class="p">};</span>
</span><span class="c1">// Make sure you use the # here!</span>
<span class="kd">var</span> <span class="nx">container</span> <span class="o">=</span> <span class="nx">d3</span><span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="s1">&#39;#county-homicides&#39;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">containerWidth</span> <span class="o">=</span> <span class="nx">container</span><span class="p">.</span><span class="nx">node</span><span class="p">().</span><span class="nx">offsetWidth</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">containerHeight</span> <span class="o">=</span> <span class="nx">containerWidth</span> <span class="o">*</span> <span class="mf">0.66</span><span class="p">;</span>
<span class="hll"><span class="kd">var</span> <span class="nx">chartWidth</span> <span class="o">=</span> <span class="nx">containerWidth</span> <span class="o">-</span> <span class="nx">margin</span><span class="p">.</span><span class="nx">right</span> <span class="o">-</span> <span class="nx">margin</span><span class="p">.</span><span class="nx">left</span><span class="p">;</span>
</span><span class="hll"><span class="kd">var</span> <span class="nx">chartHeight</span> <span class="o">=</span> <span class="nx">containerHeight</span> <span class="o">-</span> <span class="nx">margin</span><span class="p">.</span><span class="nx">top</span> <span class="o">-</span> <span class="nx">margin</span><span class="p">.</span><span class="nx">bottom</span><span class="p">;</span>
</span>
<span class="kd">var</span> <span class="nx">svg</span> <span class="o">=</span> <span class="nx">container</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s1">&#39;svg&#39;</span><span class="p">)</span>
            <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;width&#39;</span><span class="p">,</span> <span class="nx">containerWidth</span><span class="p">)</span>
            <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;height&#39;</span><span class="p">,</span> <span class="nx">containerHeight</span><span class="p">)</span>
</pre></div>
</div>
<p>Second, we should add a <code class="docutils literal notranslate"><span class="pre">&lt;g&gt;</span></code>, or “group” tag, where everything else in our chart will go. Add this to the end of your <code class="docutils literal notranslate"><span class="pre">svg</span></code> declaration. We’ll also want to give it a <code class="docutils literal notranslate"><span class="pre">transform</span></code> attribute that shifts it slightly according to our margins.</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="c1">// ... more code is up here</span>
<span class="kd">var</span> <span class="nx">svg</span> <span class="o">=</span> <span class="nx">container</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s1">&#39;svg&#39;</span><span class="p">)</span>
        <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;width&#39;</span><span class="p">,</span> <span class="nx">chartWidth</span><span class="p">)</span>
        <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;height&#39;</span><span class="p">,</span> <span class="nx">chartHeight</span><span class="p">)</span>
<span class="hll">        <span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s1">&#39;g&#39;</span><span class="p">)</span>
</span><span class="hll">        <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;transform&#39;</span><span class="p">,</span> <span class="sb">`translate(</span><span class="si">${</span><span class="nx">margin</span><span class="p">.</span><span class="nx">left</span><span class="si">}</span><span class="sb">, </span><span class="si">${</span><span class="nx">margin</span><span class="p">.</span><span class="nx">top</span><span class="si">}</span><span class="sb">)`</span><span class="p">)</span>
</span></pre></div>
</div>
<p>Adding the <code class="docutils literal notranslate"><span class="pre">g</span></code> tag and shifting it may seem like a weird step, but it’s an important step to take to make sure the value labels aren’t going to clip off the edges of our charts. To show what this does, this example skips a few steps ahead so you can see elements inside the <code class="docutils literal notranslate"><span class="pre">g</span></code> tag shifted by the margins of the chart.</p>
<a class="reference internal image-reference" href="_images/chart-g-margins.png"><img alt="_images/chart-g-margins.png" src="_images/chart-g-margins.png" style="width: 100%;" /></a>
<p>And here’s what it looks like without the margins, see how the labels are clipped?</p>
<a class="reference internal image-reference" href="_images/chart-g-nomargins.png"><img alt="_images/chart-g-nomargins.png" src="_images/chart-g-nomargins.png" style="width: 100%;" /></a>
<p>At this point, we’re ready to start drawing our chart. Let’s start by creating the “scales” for our data. D3 manages its data by mapping input values from the data, also known as the domain, into output values on the screen, or the range. This creates a scale that transforms the input into the output.</p>
<p>D3 has many different types of scales, for linear, categorical and time-based data. In this case, we’ll want a linear scale for the Y axis, and a “band” scale, which is a type of categorical scale useful for bar charts, for the X axis.</p>
<p>I like to calculate the input, or domain, before creating the axes. The domain takes the form of an array with the minimum and maximum value that you want to map: e.g., <code class="docutils literal notranslate"><span class="pre">[0,</span> <span class="pre">100]</span></code> if you’re looking at a 100-point grade scale. We can use D3’s <code class="docutils literal notranslate"><span class="pre">min</span></code> and <code class="docutils literal notranslate"><span class="pre">max</span></code> helper functions to find this.</p>
<p>If you look at the data in <code class="docutils literal notranslate"><span class="pre">src/_data/annual_totals.json</span></code>, you’ll see that each year’s data is organized like this:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s2">&quot;year&quot;</span><span class="o">:</span><span class="mf">2000</span><span class="p">,</span>
  <span class="s2">&quot;homicides_total&quot;</span><span class="o">:</span><span class="mf">1036</span><span class="p">,</span>
  <span class="s2">&quot;homicides_harvard_park&quot;</span><span class="o">:</span><span class="mf">3</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Since we’re charting homicides for the entire county we want the <code class="docutils literal notranslate"><span class="pre">homicides_total</span></code> attribute in our data for the Y axis, and the X axis will be the year. The arrow <code class="docutils literal notranslate"><span class="pre">=&gt;</span></code> is a shorthand method of accessing the <code class="docutils literal notranslate"><span class="pre">homicides_total</span></code> attribute of each object in the annualTotals array.</p>
<p>For the X axis, all we want is an array of the years, e.g.:<code class="docutils literal notranslate"><span class="pre">[2000,</span> <span class="pre">2001,</span> <span class="pre">...]</span></code> so we can call <code class="docutils literal notranslate"><span class="pre">.map()</span></code> on our data to return the year value. <code class="docutils literal notranslate"><span class="pre">.map()</span></code> iterates over every value in an array and returns a value for every item.</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="c1">// The rest of your code is up here</span>

<span class="kd">var</span> <span class="nx">xDomain</span> <span class="o">=</span> <span class="nx">annualTotals</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">d</span> <span class="p">=&gt;</span> <span class="nx">d</span><span class="p">.</span><span class="nx">year</span><span class="p">);</span>
</pre></div>
</div>
<p>For the Y-axis, we want the domain to start at 0, so we can set that manually. We can use D3’s <code class="docutils literal notranslate"><span class="pre">max</span></code> method to get the largest value in the dataset.</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="c1">// The rest of your code is up here</span>

<span class="kd">var</span> <span class="nx">yDomain</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0</span><span class="p">,</span> <span class="nx">d3</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">annualTotals</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">d</span> <span class="p">=&gt;</span> <span class="nx">d</span><span class="p">.</span><span class="nx">homicides_total</span><span class="p">))];</span>
</pre></div>
</div>
<p>If you know the min and max values, you can also set these manually, which can be useful if you want your chart max to be a nice even number.</p>
<p>At the bottom of your file, let’s create an <code class="docutils literal notranslate"><span class="pre">xScale</span></code> and <code class="docutils literal notranslate"><span class="pre">yScale</span></code> now. Note that at this point we’re also setting the range, or output values, to the range between 0 and the height and width of our SVG.</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="c1">// The rest of your code is up here</span>

<span class="kd">var</span> <span class="nx">xScale</span> <span class="o">=</span> <span class="nx">d3</span><span class="p">.</span><span class="nx">scaleBand</span><span class="p">()</span>
  <span class="p">.</span><span class="nx">domain</span><span class="p">(</span><span class="nx">xDomain</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">range</span><span class="p">([</span><span class="mf">0</span><span class="p">,</span> <span class="nx">chartWidth</span><span class="p">])</span>
  <span class="p">.</span><span class="nx">padding</span><span class="p">(</span><span class="mf">0.1</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">yScale</span> <span class="o">=</span> <span class="nx">d3</span><span class="p">.</span><span class="nx">scaleLinear</span><span class="p">()</span>
  <span class="p">.</span><span class="nx">domain</span><span class="p">(</span><span class="nx">yDomain</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">range</span><span class="p">([</span><span class="nx">chartHeight</span><span class="p">,</span> <span class="mf">0</span><span class="p">]);</span>
</pre></div>
</div>
<p>Note that the X scale has an additional method, <code class="docutils literal notranslate"><span class="pre">.padding()</span></code>, which specifies how far apart our bars are from one another.</p>
<p>Now that we have scales, we can create our axes. D3 has helper functions for each side of the chart we want our axes on, in this case the left for the Y-axis and bottom for the X-axis. We also assign one of the scales we just created to each axis.</p>
<p>For the Y-axis, we also want to add grid lines and limit the number of ticks that are shown.</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="c1">// The rest of your code is up here</span>

<span class="kd">var</span> <span class="nx">xAxis</span> <span class="o">=</span> <span class="nx">d3</span><span class="p">.</span><span class="nx">axisBottom</span><span class="p">(</span><span class="nx">xScale</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">yAxis</span> <span class="o">=</span> <span class="nx">d3</span><span class="p">.</span><span class="nx">axisLeft</span><span class="p">(</span><span class="nx">yScale</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">tickSize</span><span class="p">(</span><span class="o">-</span><span class="nx">chartWidth</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">ticks</span><span class="p">(</span><span class="mf">4</span><span class="p">);</span>
</pre></div>
</div>
<p>Finally, we append those to the chart by appending a <code class="docutils literal notranslate"><span class="pre">&lt;g&gt;</span></code> tag and “calling” the axis function we just created. I like to give each axis element a class of “axis” and “x” or “y”, depending on which axis we’re creating.</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="c1">// The rest of your code is up here</span>

<span class="nx">svg</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">&quot;g&quot;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;class&quot;</span><span class="p">,</span> <span class="s2">&quot;x axis&quot;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">xAxis</span><span class="p">);</span>

<span class="nx">svg</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">&quot;g&quot;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;class&quot;</span><span class="p">,</span> <span class="s2">&quot;y axis&quot;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">yAxis</span><span class="p">);</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="_images/chart-xaxis-top.png"><img alt="_images/chart-xaxis-top.png" src="_images/chart-xaxis-top.png" style="width: 100%;" /></a>
<p>Well that doesn’t look quite right. The reason the X axis is displaying at the top of the chart is that in SVGs, the coordinate 0,0 is at the top left. So we need to shift, or <code class="docutils literal notranslate"><span class="pre">translate</span></code> the X axis down by the height of the chart. The Y axis is fine where it is.</p>
<p>Replace the code for the X axis with the below.</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="c1">// The rest of your code is up here</span>

<span class="nx">svg</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">&quot;g&quot;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;class&quot;</span><span class="p">,</span> <span class="s2">&quot;x axis&quot;</span><span class="p">)</span>
<span class="hll">    <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;transform&quot;</span><span class="p">,</span> <span class="sb">`translate(0,</span><span class="si">${</span><span class="nx">chartHeight</span><span class="si">}</span><span class="sb">)`</span><span class="p">)</span>
</span>    <span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">xAxis</span><span class="p">);</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="_images/chart-xaxis-bottom.png"><img alt="_images/chart-xaxis-bottom.png" src="_images/chart-xaxis-bottom.png" style="width: 100%;" /></a>
<p>Now that the axes are there, we’re finally ready to draw our bars. D3 handles its data by binding the records to the SVG elements - hence the name: “Data Driven Documents.”</p>
<p>The format seems a little strange at first, because you’re selecting elements, then binding data to the selection, then creating elements that are bound to the data. You do this by chaining two methods, <code class="docutils literal notranslate"><span class="pre">.data()</span></code>, which determines the data set that you’re binding, and <code class="docutils literal notranslate"><span class="pre">.enter()</span></code>, which iterates over the data set.</p>
<p>Since we’re making a bar chart, we’re going to create a <code class="docutils literal notranslate"><span class="pre">&lt;rect&gt;</span></code> element, and give it a class of <code class="docutils literal notranslate"><span class="pre">bar</span></code>.</p>
<p>:::{note}
If you’d like to know more about how D3 data binding works, Scott Murray has an <a class="reference external" href="https://alignedleft.com/tutorials/d3/binding-data">excellent explanation and tutorial</a> on his website.
:::</p>
<p>Let’s give it a try, by binding our <code class="docutils literal notranslate"><span class="pre">annualTotals</span></code> data to the bars on the chart. Start below the code for your axes. First, let’s simply append the <code class="docutils literal notranslate"><span class="pre">&lt;rect&gt;</span></code> elements to the chart</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="c1">// The rest of your code is up here</span>

<span class="nx">svg</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s1">&#39;g&#39;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;class&#39;</span><span class="p">,</span> <span class="s1">&#39;bars&#39;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">selectAll</span><span class="p">(</span><span class="s1">&#39;.bar&#39;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="nx">annualTotals</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">enter</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s1">&#39;rect&#39;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;class&#39;</span><span class="p">,</span> <span class="s1">&#39;bar&#39;</span><span class="p">)</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="_images/chart-empty-rects.png"><img alt="_images/chart-empty-rects.png" src="_images/chart-empty-rects.png" style="width: 100%;" /></a>
<p>Now if you look at your chart… nothing has changed! But open your inspector and look at your SVG - you’ll see lots of <code class="docutils literal notranslate"><span class="pre">&lt;rect&gt;</span></code> elements, you just can’t see them because they don’t have any values for height and width, or x and y position values. Let’s do this next.</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="c1">// The rest of your code is up here</span>

<span class="nx">svg</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s1">&#39;g&#39;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;class&#39;</span><span class="p">,</span> <span class="s1">&#39;bars&#39;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">selectAll</span><span class="p">(</span><span class="s1">&#39;.bar&#39;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="nx">annualTotals</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">enter</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s1">&#39;rect&#39;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;class&#39;</span><span class="p">,</span> <span class="s1">&#39;bar&#39;</span><span class="p">)</span>
<span class="hll">    <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="nx">d</span> <span class="p">=&gt;</span> <span class="nx">xScale</span><span class="p">(</span><span class="nx">d</span><span class="p">.</span><span class="nx">year</span><span class="p">))</span>
</span><span class="hll">    <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="nx">d</span> <span class="p">=&gt;</span> <span class="nx">yScale</span><span class="p">(</span><span class="nx">d</span><span class="p">.</span><span class="nx">homicides_total</span><span class="p">))</span>
</span><span class="hll">    <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;width&#39;</span><span class="p">,</span> <span class="nx">xScale</span><span class="p">.</span><span class="nx">bandwidth</span><span class="p">())</span>
</span><span class="hll">    <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;height&#39;</span><span class="p">,</span> <span class="nx">d</span> <span class="p">=&gt;</span> <span class="nx">chartHeight</span> <span class="o">-</span> <span class="nx">yScale</span><span class="p">(</span><span class="nx">d</span><span class="p">.</span><span class="nx">homicides_total</span><span class="p">))</span>
</span></pre></div>
</div>
<p>The X value will be determined by the year, and the Y by the <code class="docutils literal notranslate"><span class="pre">homicides_total</span></code> value of each object. The width of each bar is set by a method called <code class="docutils literal notranslate"><span class="pre">.bandwidth()</span></code> on our scale, and the height will scaled corresponding to the number of homicides.</p>
<a class="reference internal image-reference" href="_images/chart-bars.png"><img alt="_images/chart-bars.png" src="_images/chart-bars.png" style="width: 100%;" /></a>
<p>You have a bar chart! At this point we can step back and style out the chart, and leave room for a second chart that shows Harvard Park homicides.</p>
<p>At this point, create a new file in the <code class="docutils literal notranslate"><span class="pre">_styles</span></code> folder, and call it <code class="docutils literal notranslate"><span class="pre">_charts.scss</span></code>.</p>
<p>The first thing we need to do is make the chart smaller - right now it’s huge! Add the following CSS rule to <code class="docutils literal notranslate"><span class="pre">_charts.scss</span></code> which will allow the chart to display at roughly half width and leave room for a second chart.</p>
<div class="highlight-css notranslate"><div class="highlight"><pre><span></span><span class="p">.</span><span class="nc">inline-chart</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">width</span><span class="p">:</span><span class="w"> </span><span class="mi">49</span><span class="kt">%</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">display</span><span class="p">:</span><span class="w"> </span><span class="kc">inline-block</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>If you look at the page now, you’ll see that nothing has changed. That’s because, like the JavaScript, we need to import the styles that we just created into our <code class="docutils literal notranslate"><span class="pre">main.scss</span></code> file.</p>
<p>You can do that by adding the following line to <code class="docutils literal notranslate"><span class="pre">main.scss</span></code>.</p>
<div class="highlight-css notranslate"><div class="highlight"><pre><span></span><span class="o">//</span><span class="w"> </span><span class="nt">Normalize</span><span class="w"> </span><span class="nt">Styles</span><span class="w"></span>
<span class="p">@</span><span class="k">import</span><span class="w"> </span><span class="s1">&#39;node_modules/normalize.css/normalize&#39;</span><span class="p">;</span><span class="w"></span>

<span class="o">//</span><span class="w"> </span><span class="nt">Import</span><span class="w"> </span><span class="nt">Modules</span><span class="w"></span>
<span class="p">@</span><span class="k">import</span><span class="w"> </span><span class="s1">&#39;../_modules/link/link&#39;</span><span class="p">;</span><span class="w"></span>
<span class="hll"><span class="p">@</span><span class="k">import</span><span class="w"> </span><span class="s1">&#39;./_charts.scss&#39;</span><span class="p">;</span><span class="w"></span>
</span></pre></div>
</div>
<a class="reference internal image-reference" href="_images/chart-half-width.png"><img alt="_images/chart-half-width.png" src="_images/chart-half-width.png" style="width: 100%;" /></a>
<p>Let’s also color the bars and clean up some of the lines. If you remember, the bars were <code class="docutils literal notranslate"><span class="pre">&lt;rect&gt;</span></code> elements, and if you use the inspector, you can find the x axis lines we want to remove. Back in <code class="docutils literal notranslate"><span class="pre">_charts.scss</span></code>:</p>
<div class="highlight-css notranslate"><div class="highlight"><pre><span></span><span class="nt">rect</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="n">fill</span><span class="p">:</span><span class="w"> </span><span class="mh">#86C7DF</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="p">.</span><span class="nc">y</span><span class="w"> </span><span class="p">.</span><span class="nc">domain</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="k">display</span><span class="p">:</span><span class="w"> </span><span class="kc">none</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="p">.</span><span class="nc">x</span><span class="w"> </span><span class="p">.</span><span class="nc">domain</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="k">display</span><span class="p">:</span><span class="w"> </span><span class="kc">none</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="p">.</span><span class="nc">x</span><span class="w"> </span><span class="p">.</span><span class="nc">tick</span><span class="w"> </span><span class="nt">line</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="k">display</span><span class="p">:</span><span class="w"> </span><span class="kc">none</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>The last thing we want to style is the grid lines - they’re too heavy and should fade into the background more. Note that we want to keep the baseline black to indicate that we’re starting at 0, so we’ll use a fancy CSS selector that says to style every tick line that’s not the baseline.</p>
<div class="highlight-css notranslate"><div class="highlight"><pre><span></span><span class="o">//</span><span class="w"> </span><span class="nt">The</span><span class="w"> </span><span class="nt">rest</span><span class="w"> </span><span class="nt">of</span><span class="w"> </span><span class="nt">your</span><span class="w"> </span><span class="nt">styles</span><span class="w"> </span><span class="nt">are</span><span class="w"> </span><span class="nt">up</span><span class="w"> </span><span class="nt">here</span><span class="w"></span>
<span class="p">.</span><span class="nc">y</span><span class="w"> </span><span class="p">.</span><span class="nc">tick</span><span class="p">:</span><span class="nd">not</span><span class="o">(</span><span class="p">:</span><span class="nd">first-of-type</span><span class="o">)</span><span class="w"> </span><span class="nt">line</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="n">stroke</span><span class="p">:</span><span class="w"> </span><span class="mh">#e7e7e7</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<a class="reference internal image-reference" href="_images/chart-styled.png"><img alt="_images/chart-styled.png" src="_images/chart-styled.png" style="width: 100%;" /></a>
<p>Now we have a nicely styled chart, and we’re ready to start on our second one. Do we want to copy everything all over again? No! Instead, we can pull the JavaScript we just wrote into a function that will take our data and an element, and create the chart for us!</p>
<p>Open up <code class="docutils literal notranslate"><span class="pre">_charts.js</span></code> again, and create a function, <code class="docutils literal notranslate"><span class="pre">createChart</span></code>. We’ll need to think about this for a second - what are the values that are going to change between the two charts?</p>
<ul class="simple">
<li><p>The container element</p></li>
<li><p>The data field used for the homicide counts</p></li>
<li><p>The y-axis values</p></li>
</ul>
<p>If we calculate the domain values correctly the Y-axis values should automatically update so we shouldn’t have to worry about that too much. So our function should have two arguments - the ID of the container element, and the data field we’re using.</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="c1">// the rest of your code is up here</span>
<span class="kd">function</span> <span class="nx">createChart</span><span class="p">(</span><span class="nx">el</span><span class="p">,</span> <span class="nx">fieldname</span><span class="p">)</span> <span class="p">{</span>

<span class="p">}</span>
</pre></div>
</div>
<p>Now, you can copy everything we wrote in <code class="docutils literal notranslate"><span class="pre">_charts.js</span></code> under the <code class="docutils literal notranslate"><span class="pre">import</span></code> line into this function. Your file should look like this now.</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="k">import</span> <span class="o">*</span> <span class="kr">as</span> <span class="nx">d3</span> <span class="kr">from</span> <span class="s2">&quot;d3&quot;</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">annualTotals</span> <span class="kr">from</span> <span class="s2">&quot;../_data/annual_totals&quot;</span><span class="p">;</span>

<span class="hll"><span class="kd">var</span> <span class="nx">createChart</span> <span class="o">=</span> <span class="p">(</span><span class="nx">el</span><span class="p">,</span> <span class="nx">fieldname</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span>  <span class="kd">var</span> <span class="nx">margin</span> <span class="o">=</span> <span class="p">{</span><span class="nx">top</span><span class="o">:</span> <span class="mf">20</span><span class="p">,</span> <span class="nx">right</span><span class="o">:</span><span class="mf">20</span><span class="p">,</span> <span class="nx">bottom</span><span class="o">:</span><span class="mf">20</span><span class="p">,</span> <span class="nx">left</span><span class="o">:</span><span class="mf">40</span><span class="p">}</span> <span class="p">;</span>
  <span class="kd">var</span> <span class="nx">container</span> <span class="o">=</span> <span class="nx">d3</span><span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="s1">&#39;#county-homicides&#39;</span><span class="p">);</span>
  <span class="kd">var</span> <span class="nx">containerWidth</span> <span class="o">=</span> <span class="nx">container</span><span class="p">.</span><span class="nx">node</span><span class="p">().</span><span class="nx">offsetWidth</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">containerHeight</span> <span class="o">=</span> <span class="nx">containerWidth</span> <span class="o">*</span> <span class="mf">0.66</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">chartWidth</span> <span class="o">=</span> <span class="nx">containerWidth</span> <span class="o">-</span> <span class="nx">margin</span><span class="p">.</span><span class="nx">right</span> <span class="o">-</span> <span class="nx">margin</span><span class="p">.</span><span class="nx">left</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">chartHeight</span> <span class="o">=</span> <span class="nx">containerHeight</span> <span class="o">-</span> <span class="nx">margin</span><span class="p">.</span><span class="nx">top</span> <span class="o">-</span> <span class="nx">margin</span><span class="p">.</span><span class="nx">bottom</span><span class="p">;</span>

  <span class="kd">var</span> <span class="nx">svg</span> <span class="o">=</span> <span class="nx">container</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s1">&#39;svg&#39;</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;width&#39;</span><span class="p">,</span> <span class="nx">containerWidth</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;height&#39;</span><span class="p">,</span> <span class="nx">containerHeight</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s1">&#39;g&#39;</span><span class="p">)</span>
        <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;transform&#39;</span><span class="p">,</span> <span class="sb">`translate(</span><span class="si">${</span><span class="nx">margin</span><span class="p">.</span><span class="nx">left</span><span class="si">}</span><span class="sb">, </span><span class="si">${</span><span class="nx">margin</span><span class="p">.</span><span class="nx">top</span><span class="si">}</span><span class="sb">)`</span><span class="p">)</span>

  <span class="kd">var</span> <span class="nx">xDomain</span> <span class="o">=</span> <span class="nx">annualTotals</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">d</span> <span class="p">=&gt;</span> <span class="nx">d</span><span class="p">.</span><span class="nx">year</span><span class="p">);</span>

  <span class="kd">var</span> <span class="nx">yDomain</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0</span><span class="p">,</span> <span class="nx">d3</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">annualTotals</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">d</span> <span class="p">=&gt;</span> <span class="nx">d</span><span class="p">.</span><span class="nx">homicides_total</span><span class="p">))];</span>

  <span class="kd">var</span> <span class="nx">xScale</span> <span class="o">=</span> <span class="nx">d3</span><span class="p">.</span><span class="nx">scaleBand</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">domain</span><span class="p">(</span><span class="nx">xDomain</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">range</span><span class="p">([</span><span class="mf">0</span><span class="p">,</span> <span class="nx">chartWidth</span><span class="p">])</span>
    <span class="p">.</span><span class="nx">padding</span><span class="p">(</span><span class="mf">0.1</span><span class="p">);</span>

  <span class="kd">var</span> <span class="nx">yScale</span> <span class="o">=</span> <span class="nx">d3</span><span class="p">.</span><span class="nx">scaleLinear</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">domain</span><span class="p">(</span><span class="nx">yDomain</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">range</span><span class="p">([</span><span class="nx">chartHeight</span><span class="p">,</span> <span class="mf">0</span><span class="p">]);</span>

  <span class="kd">var</span> <span class="nx">xAxis</span> <span class="o">=</span> <span class="nx">d3</span><span class="p">.</span><span class="nx">axisBottom</span><span class="p">(</span><span class="nx">xScale</span><span class="p">);</span>
  <span class="kd">var</span> <span class="nx">yAxis</span> <span class="o">=</span> <span class="nx">d3</span><span class="p">.</span><span class="nx">axisLeft</span><span class="p">(</span><span class="nx">yScale</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">tickSize</span><span class="p">(</span><span class="o">-</span><span class="nx">chartWidth</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">ticks</span><span class="p">(</span><span class="mf">4</span><span class="p">);</span>

  <span class="nx">svg</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">&quot;g&quot;</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;class&quot;</span><span class="p">,</span> <span class="s2">&quot;x axis&quot;</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;transform&quot;</span><span class="p">,</span> <span class="sb">`translate(0,</span><span class="si">${</span><span class="nx">chartHeight</span><span class="si">}</span><span class="sb">)`</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">xAxis</span><span class="p">);</span>

  <span class="nx">svg</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">&quot;g&quot;</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;class&quot;</span><span class="p">,</span> <span class="s2">&quot;y axis&quot;</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">yAxis</span><span class="p">);</span>

  <span class="nx">svg</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s1">&#39;g&#39;</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;class&#39;</span><span class="p">,</span> <span class="s1">&#39;bars&#39;</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">selectAll</span><span class="p">(</span><span class="s1">&#39;.bar&#39;</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="nx">annualTotals</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">enter</span><span class="p">()</span>
      <span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s1">&#39;rect&#39;</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;class&#39;</span><span class="p">,</span> <span class="s1">&#39;bar&#39;</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="nx">d</span> <span class="p">=&gt;</span> <span class="nx">xScale</span><span class="p">(</span><span class="nx">d</span><span class="p">.</span><span class="nx">year</span><span class="p">))</span>
      <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="nx">d</span> <span class="p">=&gt;</span> <span class="nx">yScale</span><span class="p">(</span><span class="nx">d</span><span class="p">.</span><span class="nx">homicides_total</span><span class="p">))</span>
      <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;width&#39;</span><span class="p">,</span> <span class="nx">xScale</span><span class="p">.</span><span class="nx">bandwidth</span><span class="p">())</span>
      <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;height&#39;</span><span class="p">,</span> <span class="nx">d</span> <span class="p">=&gt;</span> <span class="nx">chartHeight</span> <span class="o">-</span> <span class="nx">yScale</span><span class="p">(</span><span class="nx">d</span><span class="p">.</span><span class="nx">homicides_total</span><span class="p">));</span>
<span class="hll"><span class="p">}</span>
</span></pre></div>
</div>
<p>Now, if you reload your page, your chart will have disappeared! That’s because our code is packed away inside a function, which won’t run until we call on it.</p>
<p>At the end of the file, let’s return to <code class="docutils literal notranslate"><span class="pre">_charts.js</span></code> and call the function with the arguments necessary for the countywide homicides chart. Remember the element id is <code class="docutils literal notranslate"><span class="pre">county-homicides</span></code>, and the field we’re using is <code class="docutils literal notranslate"><span class="pre">homicides_total</span></code>.</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="c1">// the rest of your code is up here</span>
<span class="nx">createChart</span><span class="p">(</span><span class="s2">&quot;#county-homicides&quot;</span><span class="p">,</span> <span class="s2">&quot;homicides_total&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>You’ll see that your chart is back! But the only reason this is actually working is because we’ve already hard-coded our variables into the script. Let’s abstract it out to use the arguments that we’re providing.</p>
<p>First, let’s change the <code class="docutils literal notranslate"><span class="pre">container</span></code> variable to use the ID we’re providing.</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">createChart</span> <span class="o">=</span> <span class="p">(</span><span class="nx">el</span><span class="p">,</span> <span class="nx">fieldname</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">margin</span> <span class="o">=</span> <span class="p">{</span><span class="nx">top</span><span class="o">:</span> <span class="mf">20</span><span class="p">,</span> <span class="nx">right</span><span class="o">:</span><span class="mf">20</span><span class="p">,</span> <span class="nx">bottom</span><span class="o">:</span><span class="mf">20</span><span class="p">,</span> <span class="nx">left</span><span class="o">:</span><span class="mf">40</span><span class="p">}</span> <span class="p">;</span>
<span class="hll">  <span class="kd">var</span> <span class="nx">container</span> <span class="o">=</span> <span class="nx">d3</span><span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="nx">el</span><span class="p">);</span>
</span>
  <span class="c1">//... the function continues down here</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Now try calling it on the second element we created, with the <code class="docutils literal notranslate"><span class="pre">homicides_harvard_park</span></code> variable as the second argument.</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">createChart</span><span class="p">(</span><span class="s2">&quot;#county-homicides&quot;</span><span class="p">,</span> <span class="s2">&quot;homicides_total&quot;</span><span class="p">)</span>
<span class="hll"><span class="nx">createChart</span><span class="p">(</span><span class="s2">&quot;#harvard-park-homicides&quot;</span><span class="p">,</span> <span class="s2">&quot;homicides_harvard_park&quot;</span><span class="p">)</span>
</span></pre></div>
</div>
<a class="reference internal image-reference" href="_images/chart-twice.png"><img alt="_images/chart-twice.png" src="_images/chart-twice.png" style="width: 100%;" /></a>
<p>This gives us the same chart twice, which is expected since we still have the data values hard-coded.</p>
<p>To change this, we’ll have to find every instance where we reference the <code class="docutils literal notranslate"><span class="pre">homicides_total</span></code> field directly in the function, and change it to reference the argument we are passing in for the data field.</p>
<p>Note that in many cases we’ll have to change the syntax from <code class="docutils literal notranslate"><span class="pre">d.homicides_total</span></code> to <code class="docutils literal notranslate"><span class="pre">d[fieldname]</span></code> - this is because we’re referencing a variable and not a specific field.</p>
<p>Luckily, we only have to do this a few times, once where we’re calculating the domain, and then where we’re setting the y position and heights of the bars.</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">createChart</span> <span class="o">=</span> <span class="p">(</span><span class="nx">el</span><span class="p">,</span> <span class="nx">fieldname</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">margin</span> <span class="o">=</span> <span class="p">{</span><span class="nx">top</span><span class="o">:</span> <span class="mf">20</span><span class="p">,</span> <span class="nx">right</span><span class="o">:</span><span class="mf">20</span><span class="p">,</span> <span class="nx">bottom</span><span class="o">:</span><span class="mf">20</span><span class="p">,</span> <span class="nx">left</span><span class="o">:</span><span class="mf">40</span><span class="p">};</span>
  <span class="kd">var</span> <span class="nx">container</span> <span class="o">=</span> <span class="nx">d3</span><span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="nx">el</span><span class="p">);</span>
  <span class="kd">var</span> <span class="nx">containerWidth</span> <span class="o">=</span> <span class="nx">container</span><span class="p">.</span><span class="nx">node</span><span class="p">().</span><span class="nx">offsetWidth</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">containerHeight</span> <span class="o">=</span> <span class="nx">containerWidth</span> <span class="o">*</span> <span class="mf">0.66</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">chartWidth</span> <span class="o">=</span> <span class="nx">containerWidth</span> <span class="o">-</span> <span class="nx">margin</span><span class="p">.</span><span class="nx">right</span> <span class="o">-</span> <span class="nx">margin</span><span class="p">.</span><span class="nx">left</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">chartHeight</span> <span class="o">=</span> <span class="nx">containerHeight</span> <span class="o">-</span> <span class="nx">margin</span><span class="p">.</span><span class="nx">top</span> <span class="o">-</span> <span class="nx">margin</span><span class="p">.</span><span class="nx">bottom</span><span class="p">;</span>

  <span class="kd">var</span> <span class="nx">svg</span> <span class="o">=</span> <span class="nx">container</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s1">&#39;svg&#39;</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;width&#39;</span><span class="p">,</span> <span class="nx">containerWidth</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;height&#39;</span><span class="p">,</span> <span class="nx">containerHeight</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s1">&#39;g&#39;</span><span class="p">)</span>
        <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;transform&#39;</span><span class="p">,</span> <span class="sb">`translate(</span><span class="si">${</span><span class="nx">margin</span><span class="p">.</span><span class="nx">left</span><span class="si">}</span><span class="sb">, </span><span class="si">${</span><span class="nx">margin</span><span class="p">.</span><span class="nx">top</span><span class="si">}</span><span class="sb">)`</span><span class="p">)</span>

  <span class="kd">var</span> <span class="nx">xDomain</span> <span class="o">=</span> <span class="nx">annualTotals</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">d</span> <span class="p">=&gt;</span> <span class="nx">d</span><span class="p">.</span><span class="nx">year</span><span class="p">);</span>

<span class="hll">  <span class="kd">var</span> <span class="nx">yDomain</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0</span><span class="p">,</span> <span class="nx">d3</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">annualTotals</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">d</span> <span class="p">=&gt;</span> <span class="nx">d</span><span class="p">[</span><span class="nx">fieldname</span><span class="p">]))];</span>
</span>
  <span class="kd">var</span> <span class="nx">xScale</span> <span class="o">=</span> <span class="nx">d3</span><span class="p">.</span><span class="nx">scaleBand</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">domain</span><span class="p">(</span><span class="nx">xDomain</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">range</span><span class="p">([</span><span class="mf">0</span><span class="p">,</span> <span class="nx">chartWidth</span><span class="p">])</span>
    <span class="p">.</span><span class="nx">padding</span><span class="p">(</span><span class="mf">0.1</span><span class="p">);</span>

  <span class="kd">var</span> <span class="nx">yScale</span> <span class="o">=</span> <span class="nx">d3</span><span class="p">.</span><span class="nx">scaleLinear</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">domain</span><span class="p">(</span><span class="nx">yDomain</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">range</span><span class="p">([</span><span class="nx">chartHeight</span><span class="p">,</span> <span class="mf">0</span><span class="p">]);</span>

  <span class="kd">var</span> <span class="nx">xAxis</span> <span class="o">=</span> <span class="nx">d3</span><span class="p">.</span><span class="nx">axisBottom</span><span class="p">(</span><span class="nx">xScale</span><span class="p">);</span>
  <span class="kd">var</span> <span class="nx">yAxis</span> <span class="o">=</span> <span class="nx">d3</span><span class="p">.</span><span class="nx">axisLeft</span><span class="p">(</span><span class="nx">yScale</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">tickSize</span><span class="p">(</span><span class="o">-</span><span class="nx">chartWidth</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">ticks</span><span class="p">(</span><span class="mf">4</span><span class="p">);</span>

  <span class="nx">svg</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">&quot;g&quot;</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;class&quot;</span><span class="p">,</span> <span class="s2">&quot;x axis&quot;</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;transform&quot;</span><span class="p">,</span> <span class="sb">`translate(0,</span><span class="si">${</span><span class="nx">chartHeight</span><span class="si">}</span><span class="sb">)`</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">xAxis</span><span class="p">);</span>

  <span class="nx">svg</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">&quot;g&quot;</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;class&quot;</span><span class="p">,</span> <span class="s2">&quot;y axis&quot;</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">yAxis</span><span class="p">);</span>

  <span class="nx">svg</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s1">&#39;g&#39;</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;class&#39;</span><span class="p">,</span> <span class="s1">&#39;bars&#39;</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">selectAll</span><span class="p">(</span><span class="s1">&#39;.bar&#39;</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="nx">annualTotals</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">enter</span><span class="p">()</span>
      <span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s1">&#39;rect&#39;</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;class&#39;</span><span class="p">,</span> <span class="s1">&#39;bar&#39;</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="nx">d</span> <span class="p">=&gt;</span> <span class="nx">xScale</span><span class="p">(</span><span class="nx">d</span><span class="p">.</span><span class="nx">year</span><span class="p">))</span>
<span class="hll">      <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="nx">d</span> <span class="p">=&gt;</span> <span class="nx">yScale</span><span class="p">(</span><span class="nx">d</span><span class="p">[</span><span class="nx">fieldname</span><span class="p">]))</span>
</span>      <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;width&#39;</span><span class="p">,</span> <span class="nx">xScale</span><span class="p">.</span><span class="nx">bandwidth</span><span class="p">())</span>
<span class="hll">      <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;height&#39;</span><span class="p">,</span> <span class="nx">d</span> <span class="p">=&gt;</span> <span class="nx">chartHeight</span> <span class="o">-</span> <span class="nx">yScale</span><span class="p">(</span><span class="nx">d</span><span class="p">[</span><span class="nx">fieldname</span><span class="p">]));</span>
</span><span class="p">}</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="_images/chart-side-by-side.png"><img alt="_images/chart-side-by-side.png" src="_images/chart-side-by-side.png" style="width: 100%;" /></a>
<p>Now that our charts are smaller and they’re right next to each other, we need to clean up those year labels. Since our years are the same in both charts, we can set this manually when we’re creating the X axis.</p>
<p>Let’s update the <code class="docutils literal notranslate"><span class="pre">xAxis</span></code> variable in <code class="docutils literal notranslate"><span class="pre">createCharts</span></code> to label the first and last bars on the chart, and the 5-year intervals.</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span>  <span class="c1">// ... more code is up here</span>
  <span class="kd">var</span> <span class="nx">xAxis</span> <span class="o">=</span> <span class="nx">d3</span><span class="p">.</span><span class="nx">axisBottom</span><span class="p">(</span><span class="nx">xScale</span><span class="p">)</span>
<span class="hll">      <span class="p">.</span><span class="nx">tickValues</span><span class="p">([</span><span class="mf">2000</span><span class="p">,</span> <span class="mf">2005</span><span class="p">,</span> <span class="mf">2010</span><span class="p">,</span> <span class="mf">2015</span><span class="p">,</span> <span class="mf">2017</span><span class="p">]);</span>
</span>
  <span class="kd">var</span> <span class="nx">yAxis</span> <span class="o">=</span> <span class="nx">d3</span><span class="p">.</span><span class="nx">axisLeft</span><span class="p">(</span><span class="nx">yScale</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">tickSize</span><span class="p">(</span><span class="o">-</span><span class="nx">chartWidth</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">ticks</span><span class="p">(</span><span class="mf">4</span><span class="p">);</span>

  <span class="c1">// ... more code is down here</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="_images/chart-clean-axes.png"><img alt="_images/chart-clean-axes.png" src="_images/chart-clean-axes.png" style="width: 100%;" /></a>
<p>This cleans things up a lot! We have some pretty good-looking charts. Our charts need titles, which we can add directly to the HTML. Going back to the <code class="docutils literal notranslate"><span class="pre">index.nunjucks</span></code> file, add the titles in <code class="docutils literal notranslate"><span class="pre">&lt;h4&gt;</span></code> tags inside your chart containers</p>
<div class="highlight-jinja notranslate"><div class="highlight"><pre><span></span><span class="x">&lt;div class=&quot;charts&quot;&gt;</span>
<span class="x">  &lt;div class=&quot;inline-chart&quot; id=&quot;county-homicides&quot;&gt;</span>
<span class="hll"><span class="x">    &lt;h4 class=&quot;chart-title&quot;&gt;County homicides, 2000-2017&lt;/h4&gt;</span>
</span><span class="x">  &lt;/div&gt;</span>
<span class="x">  &lt;div class=&quot;inline-chart&quot; id=&quot;harvard-park-homicides&quot;&gt;</span>
<span class="hll"><span class="x">    &lt;h4 class=&quot;chart-title&quot;&gt;Harvard Park homicides, 2000-2017&lt;/h4&gt;</span>
</span><span class="x">  &lt;/div&gt;</span>
<span class="x">&lt;/div&gt;</span>
</pre></div>
</div>
<p>Let’s style those a bit too, add these rules to the bottom of <code class="docutils literal notranslate"><span class="pre">_styles/_charts.scss</span></code>.</p>
<div class="highlight-css notranslate"><div class="highlight"><pre><span></span><span class="p">.</span><span class="nc">chart-title</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="k">font-weight</span><span class="p">:</span><span class="w"> </span><span class="kc">bold</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="k">font-size</span><span class="p">:</span><span class="w"> </span><span class="mi">16</span><span class="kt">px</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="k">text-align</span><span class="p">:</span><span class="w"> </span><span class="kc">center</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<a class="reference internal image-reference" href="_images/chart-with-title.png"><img alt="_images/chart-with-title.png" src="_images/chart-with-title.png" style="width: 100%;" /></a>
<p>Last, let’s add a headline to introduce our charts section.</p>
<div class="highlight-jinja notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="x">&lt;h3&gt;A South L.A. neighborhood stands apart&lt;/h3&gt;</span>
</span>
<span class="x">&lt;div class=&quot;charts&quot;&gt;</span>
<span class="x">  &lt;div class=&quot;inline-chart&quot; id=&quot;county-homicides&quot;&gt;</span>
<span class="x">    &lt;h4 class=&quot;chart-title&quot;&gt;County homicides, 2000-2017&lt;/h4&gt;</span>
<span class="x">  &lt;/div&gt;</span>
<span class="x">  &lt;div class=&quot;inline-chart&quot; id=&quot;harvard-park-homicides&quot;&gt;</span>
<span class="x">    &lt;h4 class=&quot;chart-title&quot;&gt;Harvard Park homicides, 2000-2017&lt;/h4&gt;</span>
<span class="x">  &lt;/div&gt;</span>
<span class="x">&lt;/div&gt;</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="_images/chart-section-headline.png"><img alt="_images/chart-section-headline.png" src="_images/chart-section-headline.png" style="width: 100%;" /></a>
<p>And an introductory paragraph to say a little bit about what we’re looking at.</p>
<div class="highlight-jinja notranslate"><div class="highlight"><pre><span></span><span class="x">&lt;h3&gt;A South L.A. neighborhood stands apart&lt;/h3&gt;</span>
<span class="hll"><span class="x">&lt;p&gt;Harvard Park&#39;s 2016 homicide total was its highest in at least 15 years despite a downward trend in killings across L.A. County.&lt;/p&gt;</span>
</span>
<span class="x">&lt;div class=&quot;charts-holder clearfix&quot;&gt;</span>
<span class="x">    &lt;div class=&quot;inline-chart&quot; id=&quot;county-homicides&quot;&gt;&lt;/div&gt;</span>
<span class="x">    &lt;div class=&quot;inline-chart&quot; id=&quot;harvard-park-homicides&quot;&gt;&lt;/div&gt;</span>
<span class="x">&lt;/div&gt;</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="_images/chart-intro-graf.png"><img alt="_images/chart-intro-graf.png" src="_images/chart-intro-graf.png" style="width: 100%;" /></a>
<p>Last, let’s wrap our charts HTML in <code class="docutils literal notranslate"><span class="pre">&lt;section&gt;</span></code> tags to keep things orderly.</p>
<div class="highlight-jinja notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="x">&lt;section&gt;</span>
</span><span class="x">    &lt;h3&gt;A South L.A. neighborhood stands apart&lt;/h3&gt;</span>
<span class="x">    &lt;p&gt;Harvard Park&#39;s 2016 homicide total was its highest in at least 15 years despite a downward trend in killings across L.A. County.&lt;/p&gt;</span>

<span class="x">    &lt;div class=&quot;charts-holder clearfix&quot;&gt;</span>
<span class="x">        &lt;div class=&quot;inline-chart&quot; id=&quot;county-homicides&quot;&gt;&lt;/div&gt;</span>
<span class="x">        &lt;div class=&quot;inline-chart&quot; id=&quot;harvard-park-homicides&quot;&gt;&lt;/div&gt;</span>
<span class="x">    &lt;/div&gt;</span>
<span class="hll"><span class="x">&lt;/section&gt;</span>
</span></pre></div>
</div>
<p>Congratulations, you’ve made your charts! Let’s commit our changes and move on to our next challenge.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ git commit -m <span class="s2">&quot;Made my first charts.&quot;</span>
$ git push origin master
</pre></div>
</div>
<p>:::{note}
We used D3.js in this class, but there are many other JavaScript charting libraries, each one slightly different. If you want to explore this on your own, here are some other options that generally abstract away the process we used in this class.</p>
<ul class="simple">
<li><p><a class="reference external" href="https://vega.github.io/vega-lite/">Vega-lite</a></p></li>
<li><p><a class="reference external" href="http://www.chartjs.org/">Charts.js</a> Looks really awesome and abstracts a lot of the pain points of D3 away, but as it only draws to <code class="docutils literal notranslate"><span class="pre">&lt;canvas&gt;</span></code> and we wanted to be able to individually inspect SVG elements, we didn’t use it for this class.</p></li>
<li><p><a class="reference external" href="http://c3js.org/">C3.js</a> Important to note that this does not seem to support the latest versions of D3.</p></li>
</ul>
<p>There are also tools that allow you to use a visual editor, creating charts and other visualizations that you can download and/or embed in your project.</p>
<ul class="simple">
<li><p><a class="reference external" href="https://beta.observablehq.com">Observable</a> is a relatively new site that allows you to take a more exploratory approach to building your visualizations. Charts and maps update automatically as you update data or settings.</p></li>
<li><p><a class="reference external" href="https://quartz.github.io/Chartbuilder/">Chartbuilder</a> from <a class="reference external" href="https://qz.com/">Quartz</a>, is very good for basic, fast charts with light customization.</p></li>
<li><p><a class="reference external" href="https://www.datawrapper.de/">DataWrapper</a> allows a range of visualizations beyond basic charts, including scatter plots and maps.
:::</p></li>
</ul>
<p><strong>Extra credit - interactivity!</strong></p>
<p>Now let’s try and make these charts interactive. We want to highlight a bar and display its value whenever a user hovers over it. To do this, we’re going to use D3’s “event binding.”</p>
<p>In our <code class="docutils literal notranslate"><span class="pre">createChart()</span></code> function, we’ll want to add a new method, <code class="docutils literal notranslate"><span class="pre">.on()</span></code> to the code snippet where we create out bars.</p>
<p>For now, let’s log the value to our console.</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">svg</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s1">&#39;g&#39;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;class&#39;</span><span class="p">,</span> <span class="s1">&#39;bars&#39;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">selectAll</span><span class="p">(</span><span class="s1">&#39;.bar&#39;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="nx">annualTotals</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">enter</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s1">&#39;rect&#39;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;class&#39;</span><span class="p">,</span> <span class="s1">&#39;bar&#39;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="nx">d</span> <span class="p">=&gt;</span> <span class="nx">xScale</span><span class="p">(</span><span class="nx">d</span><span class="p">.</span><span class="nx">year</span><span class="p">))</span>
    <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="nx">d</span> <span class="p">=&gt;</span> <span class="nx">yScale</span><span class="p">(</span><span class="nx">d</span><span class="p">[</span><span class="nx">fieldname</span><span class="p">]))</span>
<span class="hll">    <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;width&#39;</span><span class="p">,</span> <span class="nx">d</span> <span class="p">=&gt;</span> <span class="nx">xScale</span><span class="p">.</span><span class="nx">bandwidth</span><span class="p">())</span>
</span><span class="hll">    <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;height&#39;</span><span class="p">,</span> <span class="nx">d</span> <span class="p">=&gt;</span> <span class="nx">chartHeight</span> <span class="o">-</span> <span class="nx">yScale</span><span class="p">(</span><span class="nx">d</span><span class="p">[</span><span class="nx">fieldname</span><span class="p">]))</span>
</span><span class="hll">    <span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;mouseenter&#39;</span><span class="p">,</span> <span class="nx">d</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span>        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">d</span><span class="p">[</span><span class="nx">fieldname</span><span class="p">])</span>
    <span class="p">});</span>
</pre></div>
</div>
<p>Now if you look in your console, you should see the values for each bar being logged when you mouse over.</p>
<p>Now let’s use this change each bar’s color, and the <code class="docutils literal notranslate"><span class="pre">mouseleave</span></code> event to remove that highlight when the mouse exit.</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">svg</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s1">&#39;g&#39;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;class&#39;</span><span class="p">,</span> <span class="s1">&#39;bars&#39;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">selectAll</span><span class="p">(</span><span class="s1">&#39;.bar&#39;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="nx">annualTotals</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">enter</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s1">&#39;rect&#39;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;class&#39;</span><span class="p">,</span> <span class="s1">&#39;bar&#39;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="nx">d</span> <span class="p">=&gt;</span> <span class="nx">xScale</span><span class="p">(</span><span class="nx">d</span><span class="p">.</span><span class="nx">year</span><span class="p">))</span>
    <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="nx">d</span> <span class="p">=&gt;</span> <span class="nx">yScale</span><span class="p">(</span><span class="nx">d</span><span class="p">[</span><span class="nx">fieldname</span><span class="p">]))</span>
<span class="hll">    <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;width&#39;</span><span class="p">,</span> <span class="nx">d</span> <span class="p">=&gt;</span> <span class="nx">xScale</span><span class="p">.</span><span class="nx">bandwidth</span><span class="p">())</span>
</span><span class="hll">    <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;height&#39;</span><span class="p">,</span> <span class="nx">d</span> <span class="p">=&gt;</span> <span class="nx">chartHeight</span> <span class="o">-</span> <span class="nx">yScale</span><span class="p">(</span><span class="nx">d</span><span class="p">[</span><span class="nx">fieldname</span><span class="p">]))</span>
</span><span class="hll">    <span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;mouseenter&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">d</span><span class="p">)</span> <span class="p">{</span>
</span><span class="hll">        <span class="nx">d3</span><span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">classed</span><span class="p">(</span><span class="s1">&#39;highlight&#39;</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
</span><span class="hll">    <span class="p">})</span>
</span><span class="hll">    <span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;mouseleave&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">d</span><span class="p">)</span> <span class="p">{</span>
</span>        <span class="nx">d3</span><span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">classed</span><span class="p">(</span><span class="s1">&#39;highlight&#39;</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
    <span class="p">});</span>
</pre></div>
</div>
<p>And add the rule for <code class="docutils literal notranslate"><span class="pre">.highlight</span></code> to the CSS.</p>
<div class="highlight-css notranslate"><div class="highlight"><pre><span></span><span class="p">.</span><span class="nc">highlight</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="n">fill</span><span class="p">:</span><span class="w"> </span><span class="mh">#2AB2E4</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>We have interactivity!</p>
<img alt="_images/chart-highlighting.gif" src="_images/chart-highlighting.gif" />
<p>Now let’s add a tooltip. First, in the <code class="docutils literal notranslate"><span class="pre">createCharts</span></code> function, add a line that appends a <code class="docutils literal notranslate"><span class="pre">&lt;text&gt;</span></code> element to the SVG. Place this under the lines where you append your axes to the SVG, but before you add the bars.</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">svg</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">&quot;g&quot;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;class&quot;</span><span class="p">,</span> <span class="s2">&quot;y axis&quot;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">yAxis</span><span class="p">);</span>

<span class="hll"><span class="kd">var</span> <span class="nx">tooltip</span> <span class="o">=</span> <span class="nx">svg</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s1">&#39;text&#39;</span><span class="p">)</span>
</span><span class="hll">    <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;class&#39;</span><span class="p">,</span> <span class="s1">&#39;chart-tooltip&#39;</span><span class="p">);</span>
</span></pre></div>
</div>
<p>Now in <code class="docutils literal notranslate"><span class="pre">_charts.js</span></code>, let’s go back to our <code class="docutils literal notranslate"><span class="pre">.on()</span></code> statement and try filling out the text element with the proper value, and positioning it. Let’s also clear the div when the mouse leaves.</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">svg</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s1">&#39;g&#39;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;class&#39;</span><span class="p">,</span> <span class="s1">&#39;bars&#39;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">selectAll</span><span class="p">(</span><span class="s1">&#39;.bar&#39;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="nx">annualTotals</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">enter</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s1">&#39;rect&#39;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;class&#39;</span><span class="p">,</span> <span class="s1">&#39;bar&#39;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="nx">d</span> <span class="p">=&gt;</span> <span class="nx">xScale</span><span class="p">(</span><span class="nx">d</span><span class="p">.</span><span class="nx">year</span><span class="p">))</span>
    <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="nx">d</span> <span class="p">=&gt;</span> <span class="nx">yScale</span><span class="p">(</span><span class="nx">d</span><span class="p">[</span><span class="nx">fieldname</span><span class="p">]))</span>
    <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;width&#39;</span><span class="p">,</span> <span class="nx">d</span> <span class="p">=&gt;</span> <span class="nx">xScale</span><span class="p">.</span><span class="nx">bandwidth</span><span class="p">())</span>
    <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;height&#39;</span><span class="p">,</span> <span class="nx">d</span> <span class="p">=&gt;</span> <span class="nx">chartHeight</span> <span class="o">-</span> <span class="nx">yScale</span><span class="p">(</span><span class="nx">d</span><span class="p">[</span><span class="nx">fieldname</span><span class="p">]))</span>
    <span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;mouseenter&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">d</span><span class="p">)</span> <span class="p">{</span>
<span class="hll">        <span class="nx">d3</span><span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">classed</span><span class="p">(</span><span class="s1">&#39;highlight&#39;</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
</span><span class="hll">
</span><span class="hll">        <span class="c1">// centers the text above each bar</span>
</span><span class="hll">        <span class="kd">var</span> <span class="nx">x</span> <span class="o">=</span> <span class="nx">xScale</span><span class="p">(</span><span class="nx">d</span><span class="p">.</span><span class="nx">year</span><span class="p">)</span> <span class="o">+</span> <span class="nx">xScale</span><span class="p">.</span><span class="nx">bandwidth</span><span class="p">()</span> <span class="o">/</span> <span class="mf">2</span><span class="p">;</span>
</span><span class="hll">        <span class="c1">// the - 5 bumps up the text a bit so it&#39;s not directly over the bar</span>
</span><span class="hll">        <span class="kd">var</span> <span class="nx">y</span> <span class="o">=</span> <span class="nx">yScale</span><span class="p">(</span><span class="nx">d</span><span class="p">[</span><span class="nx">fieldname</span><span class="p">])</span> <span class="o">-</span> <span class="mf">5</span><span class="p">;</span>
</span><span class="hll">
</span>        <span class="nx">tooltip</span><span class="p">.</span><span class="nx">text</span><span class="p">(</span><span class="nx">d</span><span class="p">[</span><span class="nx">fieldname</span><span class="p">])</span>
            <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;transform&#39;</span><span class="p">,</span> <span class="sb">`translate(</span><span class="si">${</span><span class="nx">x</span><span class="si">}</span><span class="sb">, </span><span class="si">${</span><span class="nx">y</span><span class="si">}</span><span class="sb">)`</span><span class="p">)</span>
<span class="hll">    <span class="p">})</span>
</span><span class="hll">    <span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;mouseleave&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">d</span><span class="p">)</span> <span class="p">{</span>
</span>        <span class="nx">d3</span><span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">classed</span><span class="p">(</span><span class="s1">&#39;highlight&#39;</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
        <span class="nx">tooltip</span><span class="p">.</span><span class="nx">text</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">);</span>
    <span class="p">});</span>
</pre></div>
</div>
<p>Now back in our CSS, we can style this out a bit.</p>
<div class="highlight-css notranslate"><div class="highlight"><pre><span></span><span class="p">.</span><span class="nc">chart-tooltip</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="k">font-family</span><span class="p">:</span><span class="w"> </span><span class="n">Helvetica</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="k">font-size</span><span class="p">:</span><span class="w"> </span><span class="mi">12</span><span class="kt">px</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="n">text-anchor</span><span class="p">:</span><span class="w"> </span><span class="kc">middle</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>You have an interactive chart!</p>
<a class="reference internal image-reference" href="_images/chart-tooltip.gif"><img alt="_images/chart-tooltip.gif" src="_images/chart-tooltip.gif" style="width: 100%;" /></a>
</section>


          </div>
              <div class="related bottom">
                &nbsp;
  <nav id="rellinks">
    <ul>
        <li>
          &larr;
          <a href="cards.html" title="Previous document"><span class="section-number">7. </span>Cards</a>
        </li>
        <li>
          <a href="map.html" title="Next document"><span class="section-number">9. </span>Map</a>
          &rarr;
        </li>
    </ul>
  </nav>
              </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">First Visual Story</a></h1>








<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="what.html">1. What you will make</a></li>
<li class="toctree-l1"><a class="reference internal" href="prereqs.html">2. Prerequisites</a></li>
<li class="toctree-l1"><a class="reference internal" href="github.html">3. Git</a></li>
<li class="toctree-l1"><a class="reference internal" href="framework.html">4. Framework</a></li>
<li class="toctree-l1"><a class="reference internal" href="template.html">5. Template</a></li>
<li class="toctree-l1"><a class="reference internal" href="data.html">6. Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="cards.html">7. Cards</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">8. Charts</a></li>
<li class="toctree-l1"><a class="reference internal" href="map.html">9. Map</a></li>
<li class="toctree-l1"><a class="reference internal" href="internet.html">10. Internet</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="cards.html" title="previous chapter"><span class="section-number">7. </span>Cards</a></li>
      <li>Next: <a href="map.html" title="next chapter"><span class="section-number">9. </span>Map</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2022.
      
      |
      <a href="_sources/charts.md.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>